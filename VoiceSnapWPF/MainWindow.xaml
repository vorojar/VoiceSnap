<Window x:Class="VoiceSnap.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        Title="VoiceSnap 语闪" 
        Height="450" Width="600"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        Background="#F2F2F7"
        Visibility="Hidden"
        ShowInTaskbar="False"
        Closing="Window_Closing"
        FontFamily="Segoe UI, Microsoft YaHei"
        FocusVisualStyle="{x:Null}">
    
    <Window.Resources>
        <!-- macOS Style Toggle Switch -->
        <Style x:Key="MacOSToggleSwitch" TargetType="CheckBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <BulletDecorator Background="Transparent" Cursor="Hand">
                            <BulletDecorator.Bullet>
                                <Grid Width="36" Height="20">
                                    <Border x:Name="BackgroundBorder" Background="#D1D1D6" CornerRadius="10" />
                                    <Ellipse x:Name="Thumb" Fill="White" Width="16" Height="16" HorizontalAlignment="Left" Margin="2,0,0,0">
                                        <Ellipse.Effect>
                                            <DropShadowEffect BlurRadius="2" ShadowDepth="1" Opacity="0.2"/>
                                        </Ellipse.Effect>
                                    </Ellipse>
                                </Grid>
                            </BulletDecorator.Bullet>
                            <ContentPresenter Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </BulletDecorator>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="#34C759"/>
                                <Setter TargetName="Thumb" Property="HorizontalAlignment" Value="Right"/>
                                <Setter TargetName="Thumb" Property="Margin" Value="0,0,2,0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
        </Style>

        <!-- Sidebar Button Style -->
        <Style x:Key="SidebarButton" TargetType="RadioButton">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Border" Background="Transparent" CornerRadius="8" Margin="10,2" Padding="12,8">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="Icon" Text="{TemplateBinding Tag}" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                <ContentPresenter VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#E5E5EA"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#007AFF"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="GroupName" Value="Sidebar"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#1C1C1E"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
        </Style>

        <!-- Card Style -->
        <Style x:Key="SettingsCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.05"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Section Header Style -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#8E8E93"/>
            <Setter Property="Margin" Value="4,0,0,8"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar -->
        <Border Grid.Column="0" Background="#EBEBF0" BorderBrush="#D1D1D6" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <StackPanel Grid.Row="0" Margin="0,20,0,0">
                    <RadioButton Content="常规" Tag="⚙️" Style="{StaticResource SidebarButton}" IsChecked="True" x:Name="NavGeneral" Click="Nav_Click"/>
                    <RadioButton Content="快捷键" Tag="⌨️" Style="{StaticResource SidebarButton}" x:Name="NavHotkeys" Click="Nav_Click"/>
                    <RadioButton Content="关于" Tag="ℹ️" Style="{StaticResource SidebarButton}" x:Name="NavAbout" Click="Nav_Click"/>
                </StackPanel>
                
                <!-- Bottom Status Dot -->
                <StackPanel Grid.Row="1" Margin="20,0,0,20" Orientation="Horizontal">
                    <Ellipse x:Name="StatusDot" Width="8" Height="8" Fill="#FF3B30" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock x:Name="StatusLabel" Text="未就绪" FontSize="11" Foreground="#8E8E93" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Content Area -->
        <Grid Grid.Column="1" Margin="30">
            <!-- General Page -->
            <StackPanel x:Name="PageGeneral" Visibility="Visible">
                <TextBlock Text="常规设置" FontSize="24" FontWeight="Bold" Margin="0,0,0,20" Foreground="#1C1C1E"/>
                
                <TextBlock Text="偏好" Style="{StaticResource SectionHeader}"/>
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <CheckBox x:Name="AutoHideCheckbox" 
                                  Content="自动隐藏指示器" 
                                  IsChecked="True"
                                  Style="{StaticResource MacOSToggleSwitch}"
                                  Checked="AutoHideCheckbox_Changed"
                                  Unchecked="AutoHideCheckbox_Changed"/>
                        <Separator Background="#F2F2F7" Margin="-16,12,-16,12"/>
                        <CheckBox x:Name="StartupCheckbox" 
                                  Content="开机自动启动" 
                                  IsChecked="False"
                                  Style="{StaticResource MacOSToggleSwitch}"
                                  Checked="StartupCheckbox_Changed"
                                  Unchecked="StartupCheckbox_Changed"/>
                    </StackPanel>
                </Border>

                <TextBlock Text="音频" Style="{StaticResource SectionHeader}"/>
                <Border Style="{StaticResource SettingsCard}">
                    <TextBlock x:Name="DeviceLabel" Text="正在检测设备..." FontSize="13" Foreground="#1C1C1E"/>
                </Border>
            </StackPanel>

            <!-- Hotkeys Page -->
            <StackPanel x:Name="PageHotkeys" Visibility="Collapsed">
                <TextBlock Text="快捷键" FontSize="24" FontWeight="Bold" Margin="0,0,0,20" Foreground="#1C1C1E"/>
                
                <TextBlock Text="录音控制" Style="{StaticResource SectionHeader}"/>
                <Border Style="{StaticResource SettingsCard}">
                    <Grid>
                        <TextBlock Text="长按触发录音" VerticalAlignment="Center" FontSize="13"/>
                        <Button x:Name="HotkeyButton" Click="HotkeyButton_Click" HorizontalAlignment="Right" Cursor="Hand" FocusVisualStyle="{x:Null}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="BtnBorder" Background="#F2F2F7" CornerRadius="6" Padding="12,6">
                                        <TextBlock x:Name="BtnText" Text="{Binding ElementName=HotkeyLabel, Path=Text}" FontWeight="Bold" Foreground="#007AFF"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="BtnBorder" Property="Background" Value="#E5E5EA"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        <!-- Hidden label to store the text for the button template -->
                        <TextBlock x:Name="HotkeyLabel" Text="Ctrl" Visibility="Collapsed"/>
                    </Grid>
                </Border>
                <TextBlock x:Name="HotkeyHint" Text="提示：点击上方按钮后按下键盘任意键即可更改。" 
                           FontSize="11" Foreground="#8E8E93" TextWrapping="Wrap" Margin="4,0,0,0"/>
            </StackPanel>

            <!-- About Page -->
            <StackPanel x:Name="PageAbout" Visibility="Collapsed">
                <Border Width="80" Height="80" Background="#007AFF" CornerRadius="18" Margin="0,20,0,20" HorizontalAlignment="Center">
                    <TextBlock Text="VS" Foreground="White" FontSize="36" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                <TextBlock Text="VoiceSnap 语闪" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center" Foreground="#1C1C1E"/>
                <TextBlock Text="版本 1.0.0 (Build 2025)" FontSize="13" Foreground="#8E8E93" HorizontalAlignment="Center" Margin="0,4,0,20"/>
                
                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <TextBlock Text="VoiceSnap 是一款极简的离线语音输入法（内置 Fun-ASR-Nano，极速、识别率超高）" 
                                   TextWrapping="Wrap" FontSize="13" LineHeight="20" Foreground="#1C1C1E"/>
                        <Separator Background="#F2F2F7" Margin="-16,12,-16,12"/>
                        <TextBlock Text="由 易哈佛小麦 设计开发" FontSize="11" Foreground="#8E8E93" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                        <Button Content="访问 GitHub 项目主页" 
                                Click="GithubButton_Click"
                                HorizontalAlignment="Center"
                                Cursor="Hand"
                                FocusVisualStyle="{x:Null}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <TextBlock Text="{TemplateBinding Content}" 
                                               Foreground="#007AFF" 
                                               FontSize="12" 
                                               TextDecorations="Underline"/>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- System Tray Icon -->
        <tb:TaskbarIcon x:Name="TrayIcon"
                        ToolTipText="VoiceSnap 语闪 - 长按 Ctrl 说话"
                        DoubleClickCommand="{Binding ShowWindowCommand}"
                        TrayLeftMouseDown="TrayIcon_TrayLeftMouseDown"
                        Visibility="Visible">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="显示窗口" Click="ShowWindow_Click"/>
                    <Separator/>
                    <MenuItem Header="退出" Click="ExitApp_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Grid>
</Window>


